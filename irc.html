<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
 <title>Perl IRC Channels</title>
 <link rel="stylesheet" href="static.css" type="text/css" />
</head>
<body>
<div id="masthead">
<!-- <img alt="Padre Logo" src="???" /> -->

<h1>Perl IRC Channels</h1> 
 <ul class="navigation">
    <li><a href="/">Home</a></li>
    <li><a href="developers.html">Developers</a></li>
    <li><a href="/trac/">Trac</a></li>
    <li><a href="http://blogs.padre.perlide.org/" title="Blogs related to Padre">Blogs</a></li>
  </ul>
</div>

<script type="text/javascript">
var channels = {
   general:      {title:"General Perl Help",      host:"irc.freenode.net", channel:"perl"},
   win32:        {title:"Win32 specific",         host:"irc.perl.org",     channel:"win32"},
   padre:        {title:"Padre, the Perl IDE",    host:"irc.perl.org",     channel:"padre"},
   catalyst:     {title:"Catalyst",               host:"irc.perl.org",     channel:"catalyst"},
   dbix_class:   {title:"DBIx::Class",            host:"irc.perl.org",     channel:"dbix-class"},
   email:        {title:"Perl Email Project",     host:"irc.perl.org",     channel:"email"},
   parrot:       {title:"Parrot",                 host:"irc.perl.org",     channel:"parrot"},
   perl_qa:      {title:"Perl Quality Assurance", host:"irc.perl.org",     channel:"perl-qa"},
   perlfr:       {title:"Perl in French",         host:"irc.perl.org",     channel:"perlfr"},
   poe:          {title:"POE",                    host:"irc.perl.org",     channel:"poe"},   
   rt:           {title:"RT",                     host:"irc.perl.org",     channel:"rt"},
   perl_help:    {title:"Perl Help",              host:"irc.perl.org",     channel:"perl-help"},
   wxperl:       {title:"Perl Help",              host:"irc.perl.org",     channel:"wxperl"},
   perl6:        {title:"Perl 6 development",     host:"irc.freenode.net", channel:"perl6"},
};


function get_values() {
    // getting the parameters from the URL
    var loc = window.location.toString().indexOf('?');
    if (loc > 0) {
        var val = window.location.toString().substr(loc + 1);
        var pairs = val.split("&");
        var data = Array;
        for (var i = 0; i < pairs.length; i++) {
	    var pair = pairs[i].split("=");
	    data[pair[0]] = pair[1];
        }
        return data;
    } else {
        return [];
    }
}

function on_click() {

    var name;
    for (var i = 0; i < document.forms.n.channel.length; i++) {
	if (document.forms.n.channel[i].checked) {
	    name = document.forms.n.channel[i].value;
	}
    }
    
    var url;
    if (channels[name].host == 'irc.freenode.net') {
	url =  'http://webchat.freenode.net/?';
	url += 'channels=' + channels[name].channel;
	url += '&nick=' + document.forms.n.nickname.value;
    } else {
	url = 'http://widget.mibbit.com/?autoConnect=true';
	url += '&server=' + channels[name].host;
	url += '&chanel=#' + channels[name].channel;
	url += '&nick=' + document.forms.n.nickname.value;
    }
    //alert(url);
    window.location = url;
}

</script>
<p>
Please select a nickname and click on one of the links.
</p>
<form name="n">
Nickname: <input name="nickname" value=""> <input type="button" OnClick="javascript:on_click()" value="Connect">



<!--
todo: check values received on the url:
   hash_key (maybe that should be host_channel instead of of our own special name)
   
   redirect to selected url
   have drop-down box with list of channels or radio buttons ??
   show the localized channels first ?
   
   if all the necessary input is available don't even show this page just redirect to 
   the mibbit service

-->

<table>
<script type="text/javascript">

var values = get_values();
if (values["nickname"]) {
    document.forms.n.nickname.value = values["nickname"];
} else {
    var nick = Math.floor(Math.random()*10000);
    document.forms.n.nickname.value = "user_" + nick;
}

for (var i in channels) {
    document.write('<tr><td><input type="radio" name="channel" value="' + i + '">' + channels[i].title + '</td></tr>');
}
</script>
</table>
</form>

</body>
</html>
